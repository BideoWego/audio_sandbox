<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Audio Sandbox</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  </head>
  <body>

    <header class="page-header text-center">
      <h1>Audio Sandbox</h1>
    </header>

    <main class="container text-center">
      <p>
        Beat:
        <span id="beat">0</span>
      </p>
      <p>
        Measure:
        <span id="measure">0</span>
      </p>
      <a id="play" href="#" class="btn btn-lg">
        Play
      </a>
      <a id="stop" href="#" class="btn btn-lg">
        Stop
      </a>
    </main>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- My Scripts -->
    <script src="/assets/javascripts/bpm.js"></script>

    <!-- Init -->
    <script>
      var kick = new Audio('/assets/audio/kick.wav');
      var snare = new Audio('/assets/audio/snare.wav');
      var hh = new Audio('/assets/audio/hh.wav');

      $(function() {
        bpm({ baseDuration: 0.5 });

        bpm.on('beat', function(n, m) {
          if (n === Math.floor(n)) {
            kick.currentTime = 0;
            kick.play();
          }

          if (m > 3 && (n === 1 || n === 3)) {
            snare.currentTime = 0;
            snare.play();
          }

          if (m > 1 && n !== Math.floor(n)) {
            hh.currentTime = 0;
            hh.play();
          }

          $('#beat').text(n);
          $('#measure').text(m);
        });

        $('#play').click(function(e) {
          e.preventDefault();
          bpm.start();
          return false;
        });

        $('#stop').click(function(e) {
          e.preventDefault();
          bpm.stop();
          $('#beat').text(0);
          $('#measure').text(0);
          return false;
        });
      });
    </script>
  </body>
</html>
